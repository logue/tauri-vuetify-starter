# 対応フォーマットガイド

## 対応入力形式

Drop Compress Imageでは、下記形式の入力画像に対応しています：

- AV1 Image Format (`*.avif`)
- Microsoft Windows Bitmap Image (`*.bmp`)
- Direct Draw Surface (`*.dds`)
- Farbfeld (`*.ff`)
- Graphics Interchange Format (`*.gif`)
- Radiance High Dynamic Range image file (`*.hdr`)
- Computer icon encoded in ICO file format (`*.ico`)
- Joint Photographic Experts Group (`*.jpg`, `*.jpeg`)
- OpenEXR image (`*.exr`)
- Portable Network Graphic (`*.png`)
- Portable Any Map (`*.pnm`)
- Quite OK Image Format (`*.qoi`)
- Truevision Graphics Adapter (`*.tga`)
- Tagged Image File Format (`*.tif`, `*.tiff`)
- WebP (`*.webp`)
- JPEG 2000 (`*.jp2`, `*.j2c`, `*.j2k`, `*.jpf`, `*.jpx`, `*.jpm`, `*.mj2`, `*.jph`)
- JPEG XL (`*.jxl`)

## 対応出力形式

ここでは、本プログラムにおける対応出力フォーマットについて解説します。

### PNG（Oxipng）

PNG（Portable Network Graphic）は、画像を「**画質を全く落とさずに**」保存できる形式です。
本プログラムで使用しているZopfli（ゾップフリ）は、処理時間がかかるものの、このPNGを「**より小さく**」するための、Googleが作った特別な圧縮技術です。

#### PNGの特徴

- **非破壊圧縮（可逆圧縮）**：何度保存し直しても、元の画質が絶対に劣化しません。
- **透過（アルファ）**：背景を透明にできます。

#### PNGの利用シーン

- **ロゴ、アイコン、図表**：境界線がはっきりしていて色数が少ない画像、または背景を透明にしたい画像。
- **Webサイトの素材**：画質の劣化を避けたいときに使われます。
- **オリジナルデータの保存**：編集を繰り返す可能性がある画像。

### JPEG（jpegli圧縮）

JPEG（Joint Photographic Experts Group）は、主に写真に使われる形式で、「**ある程度画質が落ちてもいいから、とにかく小さく**」を重視した形式です。
本プログラムで使用しているjpegli（ジェイペグリ）は、このJPEGを更に「**見た目の劣化を抑えつつ、もっと小さく**」するためにlibjxlプロジェクト（JPEG XLと同じ）で開発された技術です。JPEG XLの技術を活用した高品質なJPEGエンコーダーです。

#### JPEGの特徴

- **非可逆圧縮**：ファイルを小さくするために、人間の目には見えにくい情報を削るため、画質が少し劣化します（圧縮率が高いほど劣化が目立ちます）。
- **高い圧縮率**：写真のように色が多く複雑な画像を、非常に小さくできます。
- **jpegli**：従来のJPEGより、同じファイルサイズなら高画質に、同じ画質ならよりファイルサイズを小さくできます。JPEG XLと同じ技術を使用しているため、高品質な圧縮が可能です。

#### JPEGの利用シーン

- **一般的な写真**：風景写真や人物写真など、色が多くグラデーションが多い画像。
- **Webサイト上の大きな写真**：読み込み速度を上げるために、ファイルサイズを最優先したい場合。

### WebP

WebP（ウェッピー）は、Googleが開発した新しい画像形式で、JPEGとPNGの良いところを合わせたような存在です。

#### WebPの特徴

- **高圧縮率と高画質の両立**：JPEGと同等の圧縮率で、PNGよりも高い画質を保つことができます。
- **ロッシー／ロスレス両対応**：非可逆圧縮（写真向け）と可逆圧縮（イラスト向け）の両方が使えます。
- **透過（アルファ）とアニメーション**：PNGのように背景の透過ができ、GIFのようにアニメーションも作れます（GIFより高画質で小さいファイルにできます）。

#### WebPの利用シーン

- **Webサイトの画像全般**：写真、アイコン、アニメーションなど、ほとんどの画像をこれに置き換えて、サイトの表示速度を上げることが目的です。
- **汎用的な画像形式**：ファイル形式の選択で迷いたくない場合に便利です。

### AVIF

AVIF （AV1 Image Format、アヴィフ）は、WebPよりもさらに新しい「次世代」の画像形式です。高画質の動画技術（AV1という技術）を応用して作られました。

#### AVIFの特徴

- **現時点でトップクラスの圧縮率**：JPEGやWebPと同じ画質でも、よりファイルサイズを小さくできます。
- **高品質な色表現**：HDR（ハイダイナミックレンジ）や広色域に対応しており、明暗の差や色の鮮やかさを非常に豊かに表現できます。
- **透過（アルファ）とアニメーション**：透過やアニメーションにも対応しています。

#### AVIFの利用シーン

- **高画質を求められるWebコンテンツ**：Netflixなどがサムネイル画像に採用するなど、画質と読み込み速度を両立させたい場合に最適です。
- **Webサイトのさらなる高速化**：WebPよりもさらに高速化を目指したい場合に検討されます。

### JPEG XL

JPEG XL（ジェイペグ エックスエル）は、これまでのJPEG規格の欠点を克服し、究極の画像形式を目指して開発された新しい形式です。
JPEGファイルならば無劣化で容量を削りつつJPEG XL形式にトランスコード出来ます。

#### JPEG XLの特徴

- **高い互換性**：既存のJPEG画像を画質を落とさずに（またはほとんど落とさずに）より小さく変換できます。
- **全方位対応**：写真・イラスト・図表など、どんな種類の画像でも高い圧縮率と画質を実現します。
- **多機能**：可逆・非可逆圧縮、透過（アルファ）、アニメーション、高画質な色（広色域・HDR）にすべて対応しています。
- **プログレッシブ表示**：画像が徐々に鮮明に表示されるため、特に大きな画像でも待ち時間を短く感じさせることができます。

#### JPEG XLの利用シーン

- **画像形式の統一**：将来的にはJPEG、PNG、GIFなど多くの形式をこれ一つで置き換えられることが期待されています。
- **画像アーカイブ**：元のJPEGを劣化させずにサイズだけを小さく保存したい場合に適しています。

## 出力形式のまとめ

| 形式           | 主なメリット                                         | 向いている利用シーン                                   | ロッシー | ロスレス | アルファ | HDR | 圧縮率 | 圧縮負荷 |
| -------------- | ---------------------------------------------------- | ------------------------------------------------------ | -------- | -------- | -------- | --- | ------ | -------- |
| PNG（Oxipng）  | 画質が劣化しない、背景が透明にできる。               | ロゴ、アイコン、図表。                                 | ❌️       | ✅️       | ✅️       | ❌️  | 低     | 高       |
| JPEG（jpegli） | 写真を非常に小さくできる。高品質な圧縮。             | Web上の一般的な写真。                                  | ✅️       | ❌️       | ❌️       | ❌️  | 高     | 低       |
| WebP           | 高圧縮で高画質、透過・アニメにも対応。               | Webサイトの汎用的な画像。                              | ✅️       | ✅️       | ✅️       | ❌️  | 中     | 中       |
| AVIF           | **最も高い圧縮率と高画質**、広色域（HDR）対応。      | 高画質と高速表示を両立したいWebサイト。                | ✅️       | ❌️[^1]   | ✅️       | ✅️  | 高     | 高       |
| JPEG XL        | すべてに対応し、JPEGとも互換性がある**究極の形式**。 | 既存のJPEGを小さくしたいとき、将来的な画像形式の統一。 | ✅️       | ✅️       | ✅️       | ✅️  | 高     | 低       |

[^1]:
    AVIFは規格上ロスレス対応ですが、高負荷の割に容量が増えてしまうため本プログラムでは実装していません。
    ロスレスで使用したい場合は、JPEG XLを使用することを推奨します。
    参照：<https://github.com/AOMediaCodec/av1-avif/issues/111>
